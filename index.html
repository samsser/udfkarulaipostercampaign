<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>UDF Karulai whatsapp DB Campaign</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }
        .no-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
        input[type=range] {
            height: 4px;
            border-radius: 2px;
        }
    </style>
</head>
<body class="bg-gray-50 text-gray-800 font-sans pb-32 md:pb-0">

    <!-- Header -->
    <header class="bg-white shadow-sm p-3 sticky top-0 z-30">
        <div class="max-w-4xl mx-auto flex justify-between items-center">
            <div class="flex items-center gap-2">
                <div class="bg-indigo-600 p-1.5 rounded-lg text-white">
                    <i data-lucide="award" width="20" height="20"></i>
                </div>
                <h1 class="text-lg font-bold text-gray-900 leading-tight">SocialWaves<br><span class="text-xs text-indigo-600 font-normal">Poster Maker</span></h1>
            </div>
            <button id="desktopDownloadBtn" disabled class="hidden md:flex items-center gap-2 px-4 py-2 rounded-full font-medium transition-colors bg-gray-200 text-gray-400 cursor-not-allowed">
                <i data-lucide="download" width="18"></i>
                <span>Download</span>
            </button>
        </div>
    </header>

    <main class="max-w-4xl mx-auto md:p-8 pt-4">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 md:gap-8 px-4 md:px-0">
          
            <!-- 1. Campaign Selection -->
            <div class="order-1 bg-white p-5 rounded-2xl shadow-sm border border-gray-100 h-fit">
                <h2 class="text-base font-semibold mb-3 flex items-center gap-2">
                    <i data-lucide="smartphone" class="text-indigo-500" width="18"></i>
                    1. Choose Campaign
                </h2>
                <!-- Dynamic Grid for Frames -->
                <div id="campaignGrid" class="grid grid-cols-3 gap-2">
                    <!-- Buttons will be injected here by JS -->
                </div>
            </div>

            <!-- 2. Upload Section -->
            <div class="order-2 bg-white p-5 rounded-2xl shadow-sm border border-gray-100 h-fit">
                <h2 class="text-base font-semibold mb-3 flex items-center gap-2">
                    <i data-lucide="image" class="text-indigo-500" width="18"></i>
                    2. Upload Photo
                </h2>
                <label class="flex flex-col items-center justify-center w-full h-24 border-2 border-dashed border-indigo-200 rounded-xl cursor-pointer bg-indigo-50 hover:bg-indigo-100 active:bg-indigo-200 transition-colors">
                    <div class="flex flex-col items-center justify-center">
                        <i data-lucide="upload" class="w-6 h-6 mb-1 text-indigo-500"></i>
                        <p class="text-xs text-gray-500 font-medium">Tap to upload image</p>
                    </div>
                    <input type="file" id="imageInput" class="hidden" accept="image/*" />
                </label>
            </div>

            <!-- 3. Preview Section -->
            <div class="order-3 md:col-start-2 md:row-start-1 md:row-span-4 md:sticky md:top-24 z-20">
                <div class="bg-white p-3 md:p-4 rounded-2xl shadow-lg border border-gray-200">
                    <div class="relative w-full aspect-square bg-gray-100 rounded-xl overflow-hidden border border-gray-100 group">
                        <canvas id="posterCanvas" class="w-full h-full object-contain" style="touch-action: auto;"></canvas>
                        
                        <div id="placeholderText" class="absolute inset-0 flex items-center justify-center pointer-events-none">
                            <div class="text-center p-6 opacity-40">
                                <i data-lucide="image" width="48" class="mx-auto mb-2"></i>
                                <p class="text-sm">Tap "Upload" to start</p>
                            </div>
                        </div>

                        <!-- Internal Controls -->
                        <div id="internalControls" class="absolute bottom-0 left-0 right-0 px-3 py-2 bg-white/70 backdrop-blur-md border-t border-white/20 hidden transition-all duration-300">
                            <div class="flex items-center justify-between gap-3">
                                <div class="flex items-center gap-2 flex-1">
                                    <i data-lucide="zoom-out" width="14" class="text-gray-600"></i>
                                    <input 
                                        type="range" 
                                        id="scaleInput"
                                        min="0.1" 
                                        max="3" 
                                        step="0.1" 
                                        value="1" 
                                        class="w-full h-1 bg-gray-400/50 rounded-lg appearance-none cursor-pointer accent-indigo-600"
                                    />
                                    <i data-lucide="zoom-in" width="14" class="text-gray-600"></i>
                                </div>
                                <button id="resetBtn" class="p-1.5 bg-white/80 text-indigo-600 rounded-full shadow-sm hover:bg-white active:bg-indigo-50 transition-colors" title="Reset Position">
                                    <i data-lucide="refresh-cw" width="14" height="14"></i>
                                </button>
                            </div>
                        </div>

                    </div>
                </div>
                <div class="mt-4 text-center md:hidden text-gray-400 text-xs">
                    Generated Poster Preview
                </div>
            </div>

        </div>
    </main>

    <div id="mobileDownloadBar" class="fixed bottom-0 left-0 right-0 bg-white border-t border-gray-200 p-4 shadow-[0_-4px_6px_-1px_rgba(0,0,0,0.1)] z-40 md:hidden transition-transform translate-y-full">
        <button id="mobileDownloadBtn" class="w-full flex items-center justify-center gap-2 bg-indigo-600 text-white py-3.5 rounded-xl font-bold text-lg shadow-lg active:scale-95 transition-transform">
            <i data-lucide="download"></i>
            Download Whatsapp DP
        </button>
    </div>

    <script>
        lucide.createIcons();

        let uploadedImage = null;
        let position = { x: 0, y: 0 };
        let scale = 1;
        let isDragging = false;
        let dragStart = { x: 0, y: 0 };
        
        // --- FRAME LOGIC START ---
        
        // 1. Define Available Frames
        const frames = [
            {
                id: 1,
                name: "ward 12 vipin karuvadan",
                image: "https://raw.githubusercontent.com/samsser/udfkarulaipostercampaign/5d5b2e554b416316fbb1f5aae8a2d799a3c984fe/3.png"
            }
            // Add more frames here easily in future
        ];

        let currentFrameIndex = 0;
        const frameImage = new Image();
        frameImage.crossOrigin = "anonymous";
        
        // 2. Render Campaign Buttons
        const campaignGrid = document.getElementById('campaignGrid');
        
        function renderCampaigns() {
            campaignGrid.innerHTML = '';
            frames.forEach((frame, index) => {
                const btn = document.createElement('button');
                const isActive = index === currentFrameIndex;
                
                // Button Styling
                btn.className = `p-2 rounded-xl border-2 transition-all ${
                    isActive ? 'border-indigo-600 bg-indigo-50 ring-2 ring-indigo-200' : 'border-gray-200 hover:border-gray-300'
                }`;
                
                btn.innerHTML = `
                    <img src="${frame.image}" class="w-full h-10 md:h-12 object-contain rounded-md mb-1.5 pointer-events-none">
                    <p class="text-[10px] uppercase tracking-wide font-bold text-center truncate text-indigo-900 pointer-events-none">${frame.name}</p>
                `;
                
                btn.onclick = () => changeFrame(index);
                campaignGrid.appendChild(btn);
            });
        }

        // 3. Change Frame Logic
        function changeFrame(index) {
            currentFrameIndex = index;
            renderCampaigns(); // Re-render to update active state
            
            // Load new frame image
            frameImage.src = frames[index].image;
        }

        // Initial Load
        frameImage.onload = () => {
             drawCanvas();
        };
        frameImage.src = frames[0].image; // Load first frame default
        renderCampaigns();

        // --- FRAME LOGIC END ---

        const canvas = document.getElementById('posterCanvas');
        const ctx = canvas.getContext('2d');
        const imageInput = document.getElementById('imageInput');
        const scaleInput = document.getElementById('scaleInput');
        const desktopDownloadBtn = document.getElementById('desktopDownloadBtn');
        const mobileDownloadBar = document.getElementById('mobileDownloadBar');
        const mobileDownloadBtn = document.getElementById('mobileDownloadBtn');
        const resetBtn = document.getElementById('resetBtn');
        const placeholderText = document.getElementById('placeholderText');
        const internalControls = document.getElementById('internalControls');

        const CANVAS_SIZE = 1000;

        canvas.width = CANVAS_SIZE;
        canvas.height = CANVAS_SIZE;

        function drawCanvas() {
            ctx.clearRect(0, 0, CANVAS_SIZE, CANVAS_SIZE);
            ctx.fillStyle = "#f3f4f6";
            ctx.fillRect(0, 0, CANVAS_SIZE, CANVAS_SIZE);

            // 1. Draw Circular Mask for User Photo
            ctx.save();
            ctx.beginPath();
            ctx.arc(CANVAS_SIZE / 2, CANVAS_SIZE / 2, CANVAS_SIZE / 2, 0, Math.PI * 2);
            ctx.closePath();
            ctx.clip(); 

            // 2. Draw User Photo
            if (uploadedImage) {
                ctx.save();
                ctx.translate(CANVAS_SIZE / 2 + position.x, CANVAS_SIZE / 2 + position.y);
                ctx.scale(scale, scale);
                ctx.drawImage(uploadedImage, -uploadedImage.width / 2, -uploadedImage.height / 2);
                ctx.restore();
            } else {
                ctx.fillStyle = "#9ca3af";
                ctx.font = "bold 30px sans-serif";
                ctx.textAlign = "center";
                ctx.fillText("Upload Photo", CANVAS_SIZE / 2, CANVAS_SIZE / 2);
            }
            ctx.restore(); 

            // 3. Draw Selected Frame Overlay
            if (frameImage.complete && frameImage.naturalHeight !== 0) {
                ctx.drawImage(frameImage, 0, 0, CANVAS_SIZE, CANVAS_SIZE);
            }
        }

        imageInput.addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (event) => {
                    const img = new Image();
                    img.onload = () => {
                        uploadedImage = img;
                        position = { x: 0, y: 0 };
                        scale = 1;
                        scaleInput.value = 1;
                        
                        placeholderText.style.display = 'none';
                        internalControls.classList.remove('hidden');
                        canvas.style.touchAction = "none";
                        
                        desktopDownloadBtn.disabled = false;
                        desktopDownloadBtn.classList.remove('bg-gray-200', 'text-gray-400', 'cursor-not-allowed');
                        desktopDownloadBtn.classList.add('bg-indigo-600', 'text-white', 'hover:bg-indigo-700', 'shadow-md');
                        
                        mobileDownloadBar.classList.remove('translate-y-full');
                        
                        drawCanvas();
                    };
                    img.src = event.target.result;
                };
                reader.readAsDataURL(file);
            }
        });

        scaleInput.addEventListener('input', (e) => {
            scale = parseFloat(e.target.value);
            drawCanvas();
        });

        resetBtn.addEventListener('click', () => {
            position = { x: 0, y: 0 };
            scale = 1;
            scaleInput.value = 1;
            drawCanvas();
        });

        const downloadImage = () => {
            if (!uploadedImage) return;
            const link = document.createElement('a');
            link.download = `campaign-poster-${frames[currentFrameIndex].name.replace(/\s+/g, '-').toLowerCase()}.png`;
            link.href = canvas.toDataURL('image/png');
            link.click();
        };

        desktopDownloadBtn.addEventListener('click', downloadImage);
        mobileDownloadBtn.addEventListener('click', downloadImage);

        function getPos(e) {
            const rect = canvas.getBoundingClientRect();
            const scaleX = canvas.width / rect.width;
            const scaleY = canvas.height / rect.height;

            const clientX = e.touches ? e.touches[0].clientX : e.clientX;
            const clientY = e.touches ? e.touches[0].clientY : e.clientY;
            
            return { x: clientX * scaleX, y: clientY * scaleY };
        }

        let lastPos = { x: 0, y: 0 };

        const startDrag = (e) => {
            if (!uploadedImage) return;
            isDragging = true;
            const pos = getPos(e);
            lastPos = pos;
        };

        const onDrag = (e) => {
            if (!isDragging || !uploadedImage) return;
            e.preventDefault(); 
            const pos = getPos(e);
            
            const dx = pos.x - lastPos.x;
            const dy = pos.y - lastPos.y;

            position.x += dx;
            position.y += dy;
            
            lastPos = pos;
            drawCanvas();
        };

        const stopDrag = () => {
            isDragging = false;
        };

        canvas.addEventListener('mousedown', startDrag);
        window.addEventListener('mousemove', onDrag);
        window.addEventListener('mouseup', stopDrag);

        canvas.addEventListener('touchstart', startDrag, { passive: false });
        window.addEventListener('touchmove', onDrag, { passive: false });
        window.addEventListener('touchend', stopDrag);

    </script>
</body>
</html>

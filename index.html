<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SocialWaves Poster Maker</title>
    <!-- Tailwind CSS for Styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        /* Custom styles if needed */
        canvas {
            touch-action: none; /* Prevent scrolling when touching canvas */
        }
    </style>
</head>
<body class="min-h-screen bg-gray-50 text-gray-800 font-sans">

    <!-- Header -->
    <header class="bg-white shadow-sm p-4 sticky top-0 z-10">
        <div class="max-w-4xl mx-auto flex justify-between items-center">
            <div class="flex items-center gap-2">
                <div class="bg-indigo-600 p-2 rounded-lg text-white">
                    <i data-lucide="award"></i>
                </div>
                <h1 class="text-xl font-bold text-gray-900">SocialWaves Maker</h1>
            </div>
            <button id="downloadBtn" disabled class="flex items-center gap-2 px-4 py-2 rounded-full font-medium transition-colors bg-gray-200 text-gray-400 cursor-not-allowed">
                <i data-lucide="download" width="18"></i>
                <span class="hidden sm:inline">Download Poster</span>
            </button>
        </div>
    </header>

    <main class="max-w-4xl mx-auto p-4 md:p-8">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
          
            <!-- Left Column: Controls -->
            <div class="space-y-6 order-2 md:order-1">
                
                <!-- 1. Upload Section -->
                <div class="bg-white p-6 rounded-2xl shadow-sm border border-gray-100">
                    <h2 class="text-lg font-semibold mb-4 flex items-center gap-2">
                        <i data-lucide="image" class="text-indigo-500"></i>
                        1. Upload Photo
                    </h2>
                    <label class="flex flex-col items-center justify-center w-full h-32 border-2 border-dashed border-indigo-200 rounded-xl cursor-pointer bg-indigo-50 hover:bg-indigo-100 transition-colors">
                        <div class="flex flex-col items-center justify-center pt-5 pb-6">
                            <i data-lucide="upload" class="w-8 h-8 mb-2 text-indigo-500"></i>
                            <p class="text-sm text-gray-500 font-medium">Click to upload image</p>
                        </div>
                        <input type="file" id="imageInput" class="hidden" accept="image/*" />
                    </label>
                </div>

                <!-- 2. Controls Section (Hidden initially) -->
                <div id="controlsSection" class="bg-white p-6 rounded-2xl shadow-sm border border-gray-100 hidden">
                    <h2 class="text-lg font-semibold mb-4 flex items-center gap-2">
                        <i data-lucide="move" class="text-indigo-500"></i>
                        2. Adjust Image
                    </h2>
                    
                    <div class="space-y-4">
                        <div class="flex items-center gap-4">
                            <i data-lucide="zoom-out" size="20" class="text-gray-500"></i>
                            <input 
                                type="range" 
                                id="scaleInput"
                                min="0.1" 
                                max="3" 
                                step="0.1" 
                                value="1" 
                                class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-indigo-600"
                            />
                            <i data-lucide="zoom-in" size="20" class="text-gray-500"></i>
                        </div>
                        <p class="text-xs text-center text-gray-400">
                            Drag the image on the preview to move it
                        </p>
                        <button id="resetBtn" class="w-full py-2 text-sm text-indigo-600 bg-indigo-50 rounded-lg hover:bg-indigo-100 flex items-center justify-center gap-2">
                            <i data-lucide="refresh-cw" width="14"></i> Reset Position
                        </button>
                    </div>
                </div>

                <!-- 3. Frame Selection -->
                <div class="bg-white p-6 rounded-2xl shadow-sm border border-gray-100">
                    <h2 class="text-lg font-semibold mb-4 flex items-center gap-2">
                        <i data-lucide="smartphone" class="text-indigo-500"></i>
                        3. Active Campaign
                    </h2>
                    <div class="grid grid-cols-3 gap-3">
                        <!-- Only Election Campaign -->
                        <button class="p-2 rounded-xl border-2 transition-all border-indigo-600 bg-indigo-50">
                            <div class="w-full h-16 rounded-md mb-2" style="background-color: #2563eb;"></div>
                            <p class="text-xs font-medium text-center truncate">Election</p>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Right Column: Preview -->
            <div class="order-1 md:order-2">
                <div class="sticky top-24">
                    <div class="bg-white p-4 rounded-3xl shadow-lg border border-gray-200">
                        <div class="relative w-full aspect-square bg-gray-100 rounded-xl overflow-hidden cursor-move touch-none">
                            <canvas id="posterCanvas" class="w-full h-full object-contain"></canvas>
                            
                            <!-- Placeholder Text -->
                            <div id="placeholderText" class="absolute inset-0 flex items-center justify-center pointer-events-none">
                                <div class="text-center p-6 opacity-40">
                                    <i data-lucide="image" width="48" class="mx-auto mb-2"></i>
                                    <p>Preview will appear here</p>
                                </div>
                            </div>
                        </div>
                        <div class="mt-4 text-center">
                            <p class="text-sm font-medium text-gray-500">
                                Generated Poster Preview (WhatsApp DP Style)
                            </p>
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </main>

    <script>
        // Initialize Icons
        lucide.createIcons();

        // State Variables
        let uploadedImage = null;
        let position = { x: 0, y: 0 };
        let scale = 1;
        let isDragging = false;
        let dragStart = { x: 0, y: 0 };

        // DOM Elements
        const canvas = document.getElementById('posterCanvas');
        const ctx = canvas.getContext('2d');
        const imageInput = document.getElementById('imageInput');
        const scaleInput = document.getElementById('scaleInput');
        const downloadBtn = document.getElementById('downloadBtn');
        const resetBtn = document.getElementById('resetBtn');
        const placeholderText = document.getElementById('placeholderText');
        const controlsSection = document.getElementById('controlsSection');

        // Constants
        const CANVAS_SIZE = 1000;
        const FRAME_COLOR = "#2563eb"; // Election Blue

        // Initial Canvas Setup
        canvas.width = CANVAS_SIZE;
        canvas.height = CANVAS_SIZE;

        // --- Functions ---

        // 1. Draw Function
        function drawCanvas() {
            // Clear Canvas
            ctx.clearRect(0, 0, CANVAS_SIZE, CANVAS_SIZE);

            // Background Fill
            ctx.fillStyle = "#f3f4f6";
            ctx.fillRect(0, 0, CANVAS_SIZE, CANVAS_SIZE);

            // --- CIRCULAR CLIPPING START ---
            ctx.save(); // Save state before clipping
            ctx.beginPath();
            ctx.arc(CANVAS_SIZE / 2, CANVAS_SIZE / 2, CANVAS_SIZE / 2, 0, Math.PI * 2);
            ctx.closePath();
            ctx.clip(); // Restrict drawing to circle

            // Draw Image
            if (uploadedImage) {
                ctx.save();
                ctx.translate(CANVAS_SIZE / 2 + position.x, CANVAS_SIZE / 2 + position.y);
                ctx.scale(scale, scale);
                ctx.drawImage(uploadedImage, -uploadedImage.width / 2, -uploadedImage.height / 2);
                ctx.restore();
            } else {
                 // Draw Text if no image
                ctx.fillStyle = "#9ca3af";
                ctx.font = "bold 30px sans-serif";
                ctx.textAlign = "center";
                ctx.fillText("Upload a photo to start", CANVAS_SIZE / 2, CANVAS_SIZE / 2);
            }

            // Draw Overlay (Gradient & Border)
            drawOverlay(ctx);

            ctx.restore(); // Restore state (remove clipping for future non-clipped drawing if needed)
        }

        // 2. Overlay Function
        function drawOverlay(ctx) {
            const w = CANVAS_SIZE;
            const h = CANVAS_SIZE;
            const borderSize = 40;

            // Gradient Overlay
            const gradient = ctx.createLinearGradient(0, h/2, 0, h);
            gradient.addColorStop(0, "transparent");
            gradient.addColorStop(0.6, FRAME_COLOR);
            gradient.addColorStop(1, "black");
            
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, w, h);

            // Circular Border
            ctx.beginPath();
            ctx.arc(w / 2, h / 2, (w / 2) - (borderSize / 2), 0, Math.PI * 2);
            ctx.lineWidth = borderSize;
            ctx.strokeStyle = FRAME_COLOR;
            ctx.stroke();

            // Text (#SocialWaves)
            ctx.save();
            ctx.fillStyle = "white";
            ctx.textAlign = "center";
            ctx.font = "bold 30px sans-serif";
            ctx.shadowColor = "black";
            ctx.shadowBlur = 4;
            ctx.fillText("#SocialWaves", w / 2, h - 100);
            ctx.restore();
        }

        // 3. Image Upload
        imageInput.addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (event) => {
                    const img = new Image();
                    img.onload = () => {
                        uploadedImage = img;
                        // Reset defaults
                        position = { x: 0, y: 0 };
                        scale = 1;
                        scaleInput.value = 1;
                        
                        // Update UI
                        placeholderText.style.display = 'none';
                        controlsSection.classList.remove('hidden');
                        downloadBtn.disabled = false;
                        downloadBtn.classList.remove('bg-gray-200', 'text-gray-400', 'cursor-not-allowed');
                        downloadBtn.classList.add('bg-indigo-600', 'text-white', 'hover:bg-indigo-700', 'shadow-md');
                        
                        drawCanvas();
                    };
                    img.src = event.target.result;
                };
                reader.readAsDataURL(file);
            }
        });

        // 4. Zoom Control
        scaleInput.addEventListener('input', (e) => {
            scale = parseFloat(e.target.value);
            drawCanvas();
        });

        // 5. Reset Button
        resetBtn.addEventListener('click', () => {
            position = { x: 0, y: 0 };
            scale = 1;
            scaleInput.value = 1;
            drawCanvas();
        });

        // 6. Download Function
        downloadBtn.addEventListener('click', () => {
            if (!uploadedImage) return;
            const link = document.createElement('a');
            link.download = 'my-election-poster.png';
            link.href = canvas.toDataURL('image/png');
            link.click();
        });

        // 7. Pan / Drag Logic (Mouse & Touch)
        function getPos(e) {
            const rect = canvas.getBoundingClientRect();
            // Scale factor between CSS pixels and Canvas pixels
            const scaleX = canvas.width / rect.width;
            const scaleY = canvas.height / rect.height;

            const clientX = e.touches ? e.touches[0].clientX : e.clientX;
            const clientY = e.touches ? e.touches[0].clientY : e.clientY;
            
            // Adjust mouse position to canvas scale logic NOT needed for dragging relative movement
            // We just need raw screen movement to translate to canvas movement
            return { x: clientX, y: clientY };
        }

        const startDrag = (e) => {
            if (!uploadedImage) return;
            isDragging = true;
            const pos = getPos(e);
            dragStart = { x: pos.x - position.x, y: pos.y - position.y };
        };

        const onDrag = (e) => {
            if (!isDragging) return;
            e.preventDefault(); // Prevent scrolling on touch
            const pos = getPos(e);
            position = {
                x: pos.x - dragStart.x,
                y: pos.y - dragStart.y
            };
            drawCanvas();
        };

        const stopDrag = () => {
            isDragging = false;
        };

        // Event Listeners for Dragging
        canvas.addEventListener('mousedown', startDrag);
        window.addEventListener('mousemove', onDrag);
        window.addEventListener('mouseup', stopDrag);

        canvas.addEventListener('touchstart', startDrag, { passive: false });
        window.addEventListener('touchmove', onDrag, { passive: false });
        window.addEventListener('touchend', stopDrag);

        // Initial Draw
        drawCanvas();

    </script>
</body>
</html>
